<html>
<head>
    <title>CFF - d3 clock tutorials</title>

    <style>
        g.ticks path {
            stroke: black;
        }

        g.ticks g.minute path {
            stroke-width: 1.5;
        }

        g.ticks g.hour path {
            stroke-width: 3;
        }

        g.hands path {
            stroke: black;
        }

        g.hands g.minutes path {
            stroke-width: 1.5;
        }

        g.hands g.hours path {
            stroke-width: 2.5;
        }

        g.hands g.seconds path {
            stroke-width: 1;
            stroke: red;
        }

        g.hands g.seconds circle {
            fill: red;
        }
    </style>
</head>
<body>
<h2>CFF</h2>

<h3></h3>

<div id="target"></div>


<script src="lib/d3.min.js"></script>
<script src="lib/underscore-min.js"></script>
<script src="date-commons.js"></script>
<script>
    var now = getNow();

    var size = 200;
    var radius = size / 2;
    //we just print out the date as text in the target element
    var svg = d3.select('#target')
            .append('svg')
            .attr({
                width: size,
                height: size
            });

    var gMain = svg.append('g').attr({
        transform: 'translate(' + radius + ',' + radius + ')'
    });

    var gTicks = gMain.append('g').attr({
        class: 'ticks'
    });

    //transform a angl between 0 and 1 in degree for svg rotation, where 0 is noon
    var rotate = function (angle01) {
        return 'rotate(' + (angle01 * 360 - 90) + ')';
    };

    var plotTicks = function (name, number, size) {
        gTicks.selectAll('g.tick.' + name)
                .data(_.range(number))
                .enter()
                .append('g')
                .attr({
                    class: 'tick ' + name,
                    transform: function (t) {
                        return 'rotate(' + (t / number * 360) + ') translate(' + radius + ',0)';
                    }
                })
                .append('path')
                .attr('d', 'm0,0 l-' + size + ',0');
    };
    plotTicks('minute', 60, radius / 15);
    plotTicks('hour', 12, radius / 10);


    //time for time
    var time = getNow();
    var gHandBackRadius = radius * 0.1;

    var gHands = gMain
            .append('g')
            .datum(now)
            .attr('class', 'hands');
    var gHandSeconds = gHands.append('g')
            .attr('class', 'seconds');
    gHandSeconds.append('path')
            .attr('d', 'M-' + gHandBackRadius + ',0 L' + radius * 0.9 + ',0');
    gHandSeconds.append('circle')
            .attr({
                cx: radius * 0.9,
                cy: 0,
                r: radius * 0.06
            });

    var gHandMinutes = gHands.append('g')
            .attr('class', 'minutes');
    gHandMinutes.append('path')
            .attr('d', 'M-' + gHandBackRadius + ',0 L' + radius * 0.9 + ',0');

    var gHandHours = gHands.append('g')
            .attr('class', 'hours');
    gHandHours.append('path')
            .attr('d', 'M-' + gHandBackRadius + ',0 L' + radius * 0.6 + ',0');

    var nextMinute = function () {
        var now = getNow();
        time.minutes= now.minutes;
        time.seconds = now.seconds;
        time.hours = now.hours;
        gHands.selectAll('g').datum(now);

        gHandMinutes.attr('transform', function(t){
            return rotate(t.minutes / 60)
        });
        gHandHours.attr('transform', function(t){
            return rotate(now.hours / 12 + t.minutes / (60 * 12) + t.seconds / (3600 * 12))
        });

        var minuteStopMillis = 2000;
        var remainMillis = (60 - now.seconds) * 1000-minuteStopMillis;
        gHandSeconds.transition()
                .duration(remainMillis)
                .ease("linear")
                .attrTween('transform', function (d, i, a) {
                    return function (i) {
                        var x = d.seconds / 60 + (1 - d.seconds / 60) * i;
                        return rotate(x);
                    }
                });
        gHandMinutes.transition()
                .delay(remainMillis+minuteStopMillis)
                .ease("bounce")
                .duration(500)
                .attrTween('transform', function (d, i, a) {
                    return function (i) {
                        var x = d.minutes / 60 + (1 / 60) * i;
                        return rotate(x);
                    }
                })
                .each("end", nextMinute);
    };

    nextMinute();

</script>

</body>
</html>